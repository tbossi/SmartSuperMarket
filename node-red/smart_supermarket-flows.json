[{"id":"11b01065.87c36","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"75994a9b.4846ac","type":"subflow","name":"TCP Set Value","info":"","in":[{"x":50,"y":30,"wires":[{"id":"8f0eb1ed.19dea"}]}],"out":[{"x":680,"y":40,"wires":[{"id":"9e926b17.bf9b5","port":0}]}]},{"id":"9764201b.6e44f8","type":"subflow","name":"TCP Get Value","info":"","in":[{"x":50,"y":30,"wires":[{"id":"bb3021cf.9d2418"}]}],"out":[{"x":780,"y":20,"wires":[{"id":"e662febb.30f3f8","port":0}]}]},{"id":"49992fa3.4072f","type":"inject","z":"11b01065.87c36","name":" temperature change crontab","topic":"","payload":"","payloadType":"date","repeat":"30","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":20,"wires":[["56acca35.ed11bc"]]},{"id":"56acca35.ed11bc","type":"function","z":"11b01065.87c36","name":"generate random temperature","func":"var getRandomInt = function (min, max) {\n    return Math.random() * (max - min + 1) + min;\n}\n\nmsg = {};\nmsg.device_id = 1;\nmsg.value = getRandomInt(1, 3).toFixed(1);\nmsg.payload = `Forced change temperature to ${msg.value}`;\nreturn msg;","outputs":1,"noerr":0,"x":470,"y":20,"wires":[["97546f0b.21e3a"]]},{"id":"9e926b17.bf9b5","type":"tcp request","z":"75994a9b.4846ac","server":"localhost","port":"9090","out":"char","splitc":"\\n","name":"tcp set request","x":430,"y":100,"wires":[[]]},{"id":"8f0eb1ed.19dea","type":"function","z":"75994a9b.4846ac","name":"create request","func":"msg.payload={};\nmsg.payload=`SET ${msg.device_id} ${msg.value}`;\nreturn msg;","outputs":1,"noerr":0,"x":230,"y":100,"wires":[["9e926b17.bf9b5"]]},{"id":"97546f0b.21e3a","type":"subflow:75994a9b.4846ac","z":"11b01065.87c36","name":"","x":740,"y":44,"wires":[[]]},{"id":"2db8164c.4d9fda","type":"inject","z":"11b01065.87c36","name":"thermostat frequence","topic":"","payload":"","payloadType":"date","repeat":"1","crontab":"","once":false,"onceDelay":0.1,"x":130,"y":140,"wires":[["f00043a8.e5bba"]]},{"id":"8373c38a.1aff38","type":"tcp request","z":"9764201b.6e44f8","server":"localhost","port":"9090","out":"time","splitc":"0","name":"tcp get request","x":460,"y":80,"wires":[["e662febb.30f3f8"]]},{"id":"bb3021cf.9d2418","type":"function","z":"9764201b.6e44f8","name":"create request","func":"msg.payload={};\nmsg.payload=`GET ${msg.device_id}`;\nreturn msg;","outputs":1,"noerr":0,"x":240,"y":80,"wires":[["8373c38a.1aff38"]]},{"id":"8b9591cd.db2128","type":"subflow:9764201b.6e44f8","z":"11b01065.87c36","name":"","x":620,"y":140,"wires":[["a5a8da7d.d083a"]]},{"id":"f00043a8.e5bba","type":"function","z":"11b01065.87c36","name":"generate get request","func":"msg = {};\nmsg.device_id = 1;\nreturn msg;","outputs":1,"noerr":0,"x":380,"y":140,"wires":[["8b9591cd.db2128"]]},{"id":"a5a8da7d.d083a","type":"function","z":"11b01065.87c36","name":"adjust temperature","func":"getAdjustment = function(preferred, actual){\n    adj = 0.0;\n    if(actual < preferred){\n      adj = 0.1;\n    }\n    else if(actual > preferred){\n      adj = - 0.1;\n    }\n    return (msg.value + adj).toFixed(1)\n};\n\nmsg.device_id = 1;\nmsg.value = getAdjustment(2, msg.value);\nmsg.payload = `adjust temperature to ${msg.value}`;\nreturn msg;","outputs":1,"noerr":0,"x":430,"y":80,"wires":[["97546f0b.21e3a"]]},{"id":"e662febb.30f3f8","type":"function","z":"9764201b.6e44f8","name":"output","func":"msg.payload = `${msg.payload}`;\narray = msg.payload.split(\" \");\nmsg.response_status = array[0]; \nmsg.device_id = array[1]; \nmsg.value = parseFloat(array[2]);\n\nreturn msg;","outputs":1,"noerr":0,"x":650,"y":80,"wires":[[]]}]